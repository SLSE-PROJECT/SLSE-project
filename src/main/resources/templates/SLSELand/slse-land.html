<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!-- 룰렛 결과 모달 -->
<div id="roulette-result-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:white; width:400px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); z-index:200;">
  <div style="padding:20px; text-align:center;">
    <h2 id="result-name" style="margin-bottom:10px;"></h2>
    <img id="result-image" style="max-width:200px; max-height:200px; object-fit:contain;">
    <p id="result-description" style="font-size:14px; margin-top:10px;"></p>
    <button onclick="closeResultModal()" style="margin-top:20px;">닫기</button>
  </div>
</div>

<button onclick="spinRoulette()">룰렛 돌리기</button>

<script>
    function spinRoulette() {
        const tokenMeta = document.querySelector('meta[name="_csrf"]');
        const headerMeta = document.querySelector('meta[name="_csrf_header"]');

        const token = tokenMeta ? tokenMeta.getAttribute('content') : null;
        const header = headerMeta ? headerMeta.getAttribute('content') : null;

        const headers = header && token ? { [header]: token } : {}; // csrf 없으면 그냥 빈 headers

        fetch("/api/roulette/spin", {
            method: "POST",
            headers: headers
        })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result-name").innerText = data.rewardName;

                const img = document.getElementById("result-image");
                if (data.rewardImage) {
                    img.src = data.rewardImage;
                    img.style.display = 'block';
                } else {
                    img.style.display = 'none';
                }

                document.getElementById("result-description").innerText = data.rewardDescription || '';
                document.getElementById("roulette-result-modal").style.display = 'block';
            })
            .catch(err => {
                alert("룰렛 오류: " + err.message);
            });
    }
</script>
</body>
</html>